---
phase: 03-content-polish
plan: 02
type: execute
wave: 2
depends_on:
  - "03-01"
files_modified:
  - _includes/anchor_headings.html
  - _layouts/post.html
  - _sass/custom.scss
autonomous: true
requirements:
  - CNT-02

must_haves:
  truths:
    - "Hovering over a post heading (h2, h3, h4) reveals a clickable '#' anchor link"
    - "Clicking the anchor link updates the URL to point to that heading's section"
    - "Anchor links do not inherit post-content link styles (no underline, no accent color by default)"
  artifacts:
    - path: "_includes/anchor_headings.html"
      provides: "Liquid include that injects anchor <a> into headings"
      contains: "heading-anchor"
    - path: "_layouts/post.html"
      provides: "Post layout using anchor_headings include"
      contains: "anchor_headings.html"
    - path: "_sass/custom.scss"
      provides: "Anchor link hover-reveal CSS"
      contains: ".heading-anchor"
  key_links:
    - from: "_layouts/post.html"
      to: "_includes/anchor_headings.html"
      via: "Liquid include directive"
      pattern: "include anchor_headings.html"
    - from: "_sass/custom.scss"
      to: "_includes/anchor_headings.html"
      via: "CSS class targeting the anchorClass parameter"
      pattern: "\\.heading-anchor"
---

<objective>
Add hoverable anchor links to post headings (h2-h4) so readers can link directly to any section of a blog post.

Purpose: When sharing a specific section of a long post, readers need direct links to individual headings. A subtle '#' icon that appears on hover provides this without cluttering the reading experience.

Output: The `anchor_headings.html` Liquid include in `_includes/`, an updated `post.html` layout using the include, and CSS for the hover-reveal behavior.
</objective>

<execution_context>
@/home/chris/.claude/get-shit-done/workflows/execute-plan.md
@/home/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-content-polish/03-RESEARCH.md
@.planning/phases/03-content-polish/03-01-SUMMARY.md
@_layouts/post.html
@_sass/custom.scss
@_includes/
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add anchor headings include and update post layout</name>
  <files>_includes/anchor_headings.html, _layouts/post.html</files>
  <action>
1. Download the `anchor_headings.html` file from the jekyll-anchor-headings v1.0.13 release and place it at `_includes/anchor_headings.html`. The file is a single Liquid template (~150 lines) that parses HTML content and injects anchor `<a>` elements into heading tags. Source URL: https://raw.githubusercontent.com/allejo/jekyll-anchor-headings/v1.0.13/anchor_headings.html

   If the download fails, use the GitHub API or raw content URL as fallback. The file must be the exact v1.0.13 release -- do not modify its internal logic.

2. In `_layouts/post.html`, replace the content rendering line:
   ```
   {{ content }}
   ```
   with:
   ```liquid
   {% include anchor_headings.html html=content anchorBody="#" anchorClass="heading-anchor" h_min=2 h_max=4 %}
   ```

   This passes compiled post HTML through the anchor include, which injects `<a class="heading-anchor">#</a>` into every h2, h3, and h4. The `h_min=2` skips h1 (post title is in the header, not content). The `h_max=4` avoids anchoring h5/h6 which are rarely used.

   IMPORTANT: Only modify `post.html`. Do NOT add this include to `default.html` -- that would cause double-processing since post.html already inherits from default.html.
  </action>
  <verify>
Run `bundle exec jekyll build` and confirm:
- Build succeeds with no errors
- Inspect a generated post HTML file in `_site/` -- headings should contain `<a class="heading-anchor" href="#heading-id">#</a>` elements
- The h1 post title (in `.post-header`) does NOT have an anchor link
- Only h2, h3, h4 within `.post-content` have anchor links
  </verify>
  <done>
Post headings h2-h4 contain injected anchor `<a>` elements with class "heading-anchor" and href pointing to the heading's auto-generated ID. The include processes content at build time with no JavaScript.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add anchor link hover-reveal CSS</name>
  <files>_sass/custom.scss</files>
  <action>
Add anchor link styles to `_sass/custom.scss`. Place them in the "INDIVIDUAL POST" section, after the existing `.post-content a:hover` rule (around line 451). Add these rules:

```scss
/* Heading anchor links */
.post-content .heading-anchor {
    opacity: 0;
    text-decoration: none;
    color: var(--text-muted);
    padding-left: 0.3em;
    font-size: 0.85em;
    transition: opacity 0.15s ease, color 0.15s ease;
}

.post-content h2:hover .heading-anchor,
.post-content h3:hover .heading-anchor,
.post-content h4:hover .heading-anchor {
    opacity: 1;
}

.post-content .heading-anchor:hover {
    color: var(--accent);
}

/* Override post-content link styles for anchor links */
.post-content a.heading-anchor {
    color: var(--text-muted);
    text-decoration: none;
    text-decoration-color: transparent;
    text-underline-offset: initial;
}
```

Key details:
- `opacity: 0` hides the anchor by default; `opacity: 1` on heading hover reveals it. Using opacity (not display/visibility) allows CSS transition animation.
- The `.post-content a.heading-anchor` override block is CRITICAL -- without it, the existing `.post-content a` styles (line 440-451) would apply underline and accent color to the anchor links, making headings look broken.
- `padding-left: 0.3em` gives spacing between heading text and the # symbol.
- `font-size: 0.85em` makes the # slightly smaller than the heading text.
  </action>
  <verify>
Run `bundle exec jekyll build` and confirm:
- `_site/assets/css/style.css` contains `.heading-anchor` rules with `opacity: 0`
- `_site/assets/css/style.css` contains `.post-content a.heading-anchor` override rules (no underline, muted color)
- The `.post-content a` styles (underline, accent color) still apply to regular in-post links
  </verify>
  <done>
Anchor links are invisible by default, appear with a smooth fade when hovering over the heading, and change to accent color when hovering directly over the # symbol. They do not inherit the post-content link underline style.
  </done>
</task>

</tasks>

<verification>
1. `bundle exec jekyll build` succeeds without errors
2. Post HTML output contains `<a class="heading-anchor" href="#heading-id">#</a>` in h2/h3/h4 tags
3. CSS output contains `.heading-anchor` hover-reveal rules and `.post-content a.heading-anchor` override rules
4. Regular post-content links still show underline and accent color (not broken by anchor CSS)
5. Anchor links do NOT appear on h1 or h5/h6 headings
</verification>

<success_criteria>
- Hovering over a post heading (h2, h3, h4) reveals a clickable '#' anchor link that fades in smoothly
- Clicking the '#' updates the browser URL to include the heading's ID fragment
- Anchor links are visually distinct from regular post links (no underline, muted color, not purple)
- The anchor include is pure Liquid -- no JavaScript required
</success_criteria>

<output>
After completion, create `.planning/phases/03-content-polish/03-02-SUMMARY.md`
</output>
